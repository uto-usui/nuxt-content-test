---
title: "wordpressで構築したサイトのサーバーの引っ越し方法 -『wordpress』"
date: "2017-01-16"
---

wordpressで構築したサイトをレンタルサーバーを変更する場合などにサーバー移転するときのtipsです。今回はロリポップからエックスサーバーの移転を例に進めていきます。

- MySQLのエクスポート
- データベースの作成
- MySQLのインポート
- WordPressファイルのダウンロード
- WordPressファイルのアップロード
- DNSネームサーバーの変更

以上の手順でサーバーの引っ越し作業を進めていきます。

## MySQLのエクスポート

phpmyadminを利用して、旧サーバーのMySQLデータベースをエクスポートしてsqlファイルをダウンロードします。ここにWordPressのデータが保存されています。

### ロリポップ

レンタルサーバー「ロリポップ！」のphpMyAdminを利用して、MySQLデータベースをエクスポートします。

#### ロリポップでのsqlファイルのエクスポート

1. ロリポップ！ログイン
2. WEBツール / 「データベース」
3. エクスポートしたい該当データベース 「操作する」
4. 「phpMyAdminを開く」
5. ユーザー名・パスワードを入力、サーバーを選択
6. ヘッダーのナビゲーション「データベース」
7. 該当データベースをクリック
8. エクスポートをクリック

## データベースの作成

移転先にWordPressサイトのデータをインポートするためのMySQLデータベースを作成します。

### エックスサーバー

エックスサーバーにMySQLデータベースの追加する方法です。

#### エックスサーバーでデータベースを追加

1. エックスサーバーのサーバーパネルにログイン
2. 「MySQL設定」
3. 「MySQLの追加」
4. MySQLデータベース名を入力して「MySQLの追加（確認）」
5. 「MySQLデータベースの追加（確定）」
6. 「MySQLユーザの追加」
7. MySQLユーザID/パスワードを入力し、「MySQLユーザの追加（確認）」
8. 「MySQLユーザの追加（確定）」
9. 「MySQL一覧」
10. 追加したユーザーを選択して、「追加」

## MySQLのインポート

ダウンロードしたsqlファイルを移転先のMySQLデータベースにインポートします。

### エックスサーバー

エックスサーバーのMySQLデータベースにデータをインポートします。

#### エックスサーバーのMySQLデータベースにインポート

1. エックスサーバーのサーバーパネルにログイン
2. 「phpmyadmin(MySQL5.7)」
3. インポートしたい(さっき作成した)MySQLデータベースを選択
4. タブメニューの「インポート」
5. インポートするファイルをローカル環境から選択して「実行する」

## WordPressファイルのダウンロード

移行したいWordPressサイトのデータ全てを旧サーバーからダウンロードします。

## WordPressファイルのアップロード

さっきダウンロードしたwp-config.phpファイルを移転先のMySQLデータベース情報(データベース名/ユーザ名/パスワード/ホスト名)に修正します。

```
define('DB_NAME', '****');
define('DB_USER', '****');
define('DB_PASSWORD', '****');
define('DB_HOST', '****');

```

## DNSネームサーバーの変更

MySQLデータベースとデータの移転が完了したら、次はDNSネームサーバーの設定を変更します。ドメインが新サーバーの方へ向くように設定します。

### エックスサーバー

エックスサーバーのネームサーバーはサーバーパネルのサーバー情報のサーバ情報タブの下部に記載されています。このネームサーバーの情報を、ドメインを取得しているサービスののコントロールパネルで設定します。

## ドメインを変更する場合の追加手順

補足として、サーバー引越を行った際にドメイン名も変更する必要がある場合には、もう一つ手順を踏む必要があります。新しいデータベースに読み込んだsqlファイルの中身を書き換えます。

### スクリプトでデータベースに読み込んだsqlファイルの中身を書き換え

適切にsqlファイルの中身を書き換えるには[DATABASE SEARCH AND REPLACE SCRIPT IN PHP](http://interconnectit.com/products/search-and-replace-for-wordpress-databases/)のスクリプトを使用します。

1. zipファイルダウンロードして解凍
2. 解凍したファイルをサーバーのドメインにアップロード
3. アップロードしたファイルにブラウザでアクセス
4. 「submit」
5. 「Submit DB details」
6. 「Continue」
7. Search forに変更前ドメインを入力
8. Replace withに変更後ドメインを入力
9. 「Submit Search string」

### 旧サーバーの.htaccessでリダイレクト

移転前サーバーのドメインルートにある.htaccessにリダイレクトさせるコードを記述します。

#### .htaccess

```
Redirect 301 / http://new-domain/

```

### ドメイン移転をGoogleに通知

新しいドメインのインデックスの速度を促進するためにドメイン移転をしたことをGoogle Search Consoleで通知します。ドメイン移転を通知する前に「移転前のドメイン」と「移転先のドメイン」をGoogle Search Consoleに登録する必要があります。[Search Console](https://www.google.com/webmasters/tools/home)でプロパティを追加から登録します。

- 旧ドメインの詳細画面をひらく
- 右上のアイコンの「アドレス変更」
- フローに従って「送信」

おわります。
